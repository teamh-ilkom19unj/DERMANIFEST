<!DOCTYPE html>
<html>
<head>
	<title>Cart</title>
	<link rel="stylesheet" type="text/css" href="../css/cart.css"/>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link href="https://fonts.googleapis.com/css2?family=Mulish&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Round|Material+Icons+Sharp" rel="stylesheet">
</head>
<body>

	<!--header paling atas-->
	<div id="top">
		<div class="d-block sticky-top header">
			<div class="row sticky-top justify-content-center isi-header">
				<div class="col-md-2 logo">
					<img src="../images/logo.png">
				</div>
				<div class="col-md-6 search">
					<input type="text" name="search-input" placeholder="&#xF002; Search skincare...">
				</div>
				<div class="col-md-2 cart">
					<a class="isi-cart" href="cart.html" id="jml-item"><div class="material-icons-outlined">shopping_cart</div>Cart: 0</a>
				</div>
				<div class="col-md-2 account">
					<div class="dropdown">
						<button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							<span class="material-icons-outlined">account_circle</span> Account
						</button>
						<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
							<a class="dropdown-item" href="#">Hello, Dear Costumer!</a>
	  						<div class="dropdown-divider"></div>
							<a class="dropdown-item" href="#"><span class="material-icons-outlined">settings</span>Account Setting</a>
							<a class="dropdown-item" href="#"><span class="material-icons-outlined">exit_to_app</span>Logout</a>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!--nav di bawah header-->
		<div class="d-block nav">
			<div class="row justify-content-center isi-nav">
				<div class="col-md-12 flex-left nav-home">
					<ul>
						<li class="first"><a href="landing.html">Home</a></li>
						<li><a href="product_list.html">Product</a></li>
						<li><a href="compare.html">Comparison</a></li>
						<li><a href="#">Care Guide</a></li>				  
					</ul>
				</div>
			</div>
		</div>
	</div>

	<!--space-->
	<div class="row space"></div>

	<!--------L O A D E R-------->
	<div id="loading" >
  		<img id="loading-image" class="text-center" src="../images/cart/loader.gif" alt="Loading..." />
	</div>


	<!--C O N T E N T-->
	<div class="my-container text-center" id="kosong">
		<div class="ilus">
			<img src="../images/cart/cart.svg">
		</div>

		<div class="deskripsi">
			<h1>Cart mu masih kosong. Ayo belanja dulu!</h1>
		</div>

		<div class="tombol">
			<button>Belanja Sekarang</button>
		</div>
	</div>

	<div class="row cart-wrapper">
		<div class="col-10 text-left">
			<h1>Cart</h1>
		</div>
		<div class="col-12 summary-wrapper">
			<table class="table table-striped">
				   <thead>
				      <tr>
					       <th style="width: 40%;"><b>Item</b></th>
					       <th style="width: 20%;"><b>Quantity</b></th>
					       <th style="width: 20%;"><b>Price</b></th>
					       <th style="width: 20%;"><b><button type="button" class="btn btn-danger" id="empty-cart" onclick="emptyCart();">Kosongkan Cart</button></b></th>
				      </tr>
				   </thead>
				   <tbody id="isi-item">
					  
				   </tbody>
				   <tbody>
					   <tr style="background-color: #FFE8C2;">
						   <td></td>
						   <td>Subtotal</td>
						   <td id="total">Rp0</td>
						   <td></td>
					   </tr>
				   </tbody>
			</table>
			<div class="checkout-btn text-right" id="chk-btn">

			</div>
		</div>
	</div>


	<!--F O O T E R-->
	<div class="footer">
		<span>
			Dermanifest | Email: teamhilkom19unj@gmail.com <br> Copyright &#169; 2020 Documentation Department <br>
		</span>
		<span class="logo">
			<img src="../images/logo.png">
		</span>
	</div>
</body>

	<!---------L O A D E R--------->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
	<script>
		$('#loading').delay(3800).hide(500); 
	</script>
	
	<!------HIDE / REVEAL HEADER--------->
	<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
	<script>
		var prevScrollpos = window.pageYOffset;
		window.onscroll = function() {
		var currentScrollPos = window.pageYOffset;
		  if (prevScrollpos > currentScrollPos) {
		    document.getElementById("top").style.top = "0";
		  } else {
		    document.getElementById("top").style.top = "-150px";
		  }
		  prevScrollpos = currentScrollPos;
		}
	</script>

	<!---RETRIEVE CART----->
	<script type="text/javascript" src="https://cdn.chec.io/v2/commerce.js"></script>
	<script>
		const commerce = new Commerce('pk_198151521f223e07df237e6a4e021d27b0114da5ccaef', true);

		//Untuk menampilkan isi cart
		commerce.cart.retrieve('cart_6oLGNkmRRmybKw').then((cart) => {
			console.log(cart)

			let item = '';

			cart.line_items.forEach((items) => {
				  item +=
				  	`<tr>
						  <td>${items.name}</td>
						  <td>
						  	<input type="number" id="item_quantity" name="item_quantity" min="1" max="20" onchange="updateItem('${items.id}', $(this).val());" value="${items.quantity}">
						  </td>
						  <td>${items.line_total.formatted_with_symbol}</td>
						  <td><a onclick="deleteFromCart('${items.id}');" class="delete"><i class="fa fa-trash-o"></i> Hapus</a></td>
					   </tr>`;
			});

			document.querySelector('#jml-item').innerHTML = `<div class="material-icons-outlined">shopping_cart</div> Cart: ${cart.total_items}`;
			document.querySelector('#isi-item').innerHTML = item;
			document.querySelector('#total').innerHTML = cart.subtotal.formatted_with_symbol;

			if (cart.line_items.length > 0) {
				document.querySelector('#kosong').innerHTML = `
				<div class="my-container text-center">
					<div class="ilus">
						<img src="../images/cart/cart_terisi.svg">
					</div>

					<div class="deskripsi">
						<h1>Cart mu sudah terisi. Sudah siap untuk checkout!</h1>
					</div>
				</div>`;
				
				document.querySelector('#chk-btn').innerHTML = `
				<button onclick="window.location.href='checkout.html';" class="selengkapnya">Checkout</button>
				`;
			}
		});

		//Meng-update quantity item dalam cart
		function updateItem(item_id, quant){
			commerce.cart.update(item_id, {quantity: quant}).then(response => {
				console.log(response)

				location.reload();
				return false;
			});	
			alert("Jumlah item sudah diupdate!")
		}
		

		//Untuk menghapus item tertentu dalam cart
		function deleteFromCart(item_id){
			commerce.cart.remove(item_id).then((response) => {
				console.log(response)

				location.reload();
				return false;
			});
			alert("Item sudah dihapus dari Cart!")
		}

		function emptyCart(){
			commerce.cart.empty().then(json => {
				console.log(json)

				location.reload();
				return false;
			});
			alert("Cart sudah dikosongkan!")
		}
	</script>
</html>
